<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–°—Ç–∞–Ω –±–∞—Ç–∞—Ä–µ–π –ø–æ —Å—Ç–æ—è–∫–∞—Ö</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; }
table { border-collapse: collapse; margin:20px auto; background:white; }
th,td { border:1px solid #999; padding:6px 8px; text-align:center; min-width:36px; }
th { background:#e0e0e0; }
.floor { font-weight:bold; background:#f0f0f0; }
.battery { cursor:pointer; border-radius:4px; font-weight:bold; }
.inactive { background:#bdbdbd; }
.hot { background:#4a90e2; color:white; }
.cold { background:#e74c3c; color:white; }
.empty { background:#fafafa; color:#aaa; }

.legend {
  max-width:800px;
  margin:15px auto;
  background:white;
  padding:12px;
  border-radius:6px;
  border:1px solid #ccc;
  display:flex;
  align-items:center;
  gap:8px;
}

.legend div {
  padding:6px 10px;
  border-radius:4px;
  font-weight:bold;
}

.last-update {
  margin-left:central;
  font-size:14px;
  color:#555;
}
</style>
</head>

<body>

<div class="legend">
  <div class="inactive">‚ö™ –ù–µ–∞–∫—Ç–∏–≤–Ω–∞</div>
  <div class="hot">üîµ –•–æ–ª–æ–¥–Ω–∞</div>
  <div class="cold">üî¥ –ì–∞—Ä—è—á–∞</div>
  <div id="lastUpdate" class="last-update">
    üïí –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: ‚Äî</div>
</div>

<table id="table">
<tr>
  <th>–ü–æ–≤–µ—Ä—Ö</th>
  <th colspan="9">–ö–≤–∞—Ä—Ç–∏—Ä–∏</th>
</tr>
</table>

<div class="info">
<b>–Ø–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—å:</b><br>
–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä–∏, —â–æ–± –∑–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞–Ω –±–∞—Ç–∞—Ä–µ—ó.<br>
‚ö™ ‚Üí üîµ ‚Üí üî¥ ‚Üí ‚ö™<br>
–ó–º—ñ–Ω–∏ –º–∏—Ç—Ç—î–≤–æ –±–∞—á–∞—Ç—å —É—Å—ñ, —Ö—Ç–æ –≤—ñ–¥–∫—Ä–∏–≤ —Å—Ç–æ—Ä—ñ–Ω–∫—É.
</div>

<script>
/* üî• FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyD-XXXXXXXX",
  authDomain: "heating-map.firebaseapp.com",
  databaseURL: "https://heating-map-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "heating-map",
  storageBucket: "heating-map.appspot.com",
  messagingSenderId: "1234567890",
  appId: "1:1234567890:web:abcdef123456"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const batteriesRef = db.ref("batteries");
const lastUpdateRef = db.ref("meta/lastUpdate");

/* üïí –î–ê–¢–ê –û–ù–û–í–õ–ï–ù–ù–Ø */
lastUpdateRef.on("value", snap => {
  if (!snap.exists()) return;
  document.getElementById("lastUpdate").textContent =
    "üïí –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: " + formatDate(new Date(snap.val()));
});

function formatDate(d){
  const n=new Date();
  if(d.toDateString()===n.toDateString())
    return "—Å—å–æ–≥–æ–¥–Ω—ñ –æ " + d.toLocaleTimeString("uk-UA",{hour:"2-digit",minute:"2-digit"});
  return d.toLocaleString("uk-UA");
}

/* üè¢ –î–ê–ù–Ü –ë–£–î–ò–ù–ö–£ */
const floors = [
  [1,2,3,4,5,6],
  [7,8,9,10,11,12],
  [13,14,15,16,17,18,19,20,21],
  [22,23,24,25,26,27,28,29,30],
  [31,32,33,34,35,36,37,38,39],
  [40,41,42,43,44,45,46,47,48],
  [49,50,51,52,53,54,55,56,57],
  [58,59,60,61,62,63,64,65,66],
  [67,68,69,70,71,72,73,74,75],
  [76,77,78,79,80,81,82,83,84],
  [85,86,87,88,89,90,91,92,93],
  [94,95,96,97,98,99,null,100,101],
  [102,103,104,105,106,107,null,108,109],
  [110,111,112,113,114,115,null,116,117]
];

const states=["inactive","hot","cold"];
const table=document.getElementById("table");

/* üß± –ü–û–ë–£–î–û–í–ê –¢–ê–ë–õ–ò–¶–Ü */
floors.forEach((row,i)=>{
  const tr=document.createElement("tr");
  tr.innerHTML=`<td class="floor">${i+1}</td>`;
  for(let c=0;c<9;c++){
    const td=document.createElement("td");
    const id=row[c];
    if(!id){ td.textContent="‚Äî"; td.className="empty"; }
    else{
      td.textContent=id;
      td.className="battery inactive";
      td.onclick=()=>cycle(id);
      batteriesRef.child(id).on("value",s=>{
        td.className="battery "+(s.val()||"inactive");
      });
    }
    tr.appendChild(td);
  }
  table.appendChild(tr);
});

/* üîÅ –ö–õ–Ü–ö */
function cycle(id){
  batteriesRef.child(id).get().then(s=>{
    const cur=s.val()||"inactive";
    const next=states[(states.indexOf(cur)+1)%states.length];
    batteriesRef.child(id).set(next);
    lastUpdateRef.set(Date.now());
  });
}
</script>

</body>
</html>


